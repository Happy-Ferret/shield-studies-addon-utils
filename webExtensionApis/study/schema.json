[
  {
    "namespace": "study",
    "description": "Interface for shield studies, for use by `background.js` scripts.",
    "apiVersion": 5,
    "types": [
      {
        "id": "studySetup",
        "type": "object",
        "additionalProperties": {
          "type": "any"
        }
      },
      {
        "id": "weightedVariations",
        "type": "array"
      },
      {
        "id": "anEnding",
        "type": "object",
        "additionalProperties": {
          "type": "any"
        }
      }
    ],
    "functions": [
      {
        "name": "setup",
        "type": "function",
        "description": "Configure the study.\n\n- Validate the study configuation, so that all fields needed for study lifecycle telemetry are present.\n",
        "async": true,
        "parameters": [
          {
            "name": "studySetup",
            "$ref": "studySetup"
          }
        ]
      },
      {
        "name": "install",
        "type": "function",
        "async": true,
        "description": "all for side effects (sending 'install', 'enter') pings",
        "returns": "Nothing",
        "parameters": []
      },
      {
        "name": "startup",
        "type": "function",
        "async": true,
        "description": "all for side effects (setActiveExperiment)",
        "returns": "Nothing",
        "parameters": []
      },
      {
        "name": "endStudy",
        "type": "function",
        "async": true,
        "defaultReturn": "endingName",
        "description": "Optionally opens url, then ends study with pings ending, exit.  Study can only have one ending.  Uninstalls addon?",
        "parameters": [
          {
            "name": "anEndingName",
            "type": "string"
          },
          {
            "name": "anEndingObject",
            "type": "object"
          }
        ],
        "returns": "directions for what to do next by the addon"
      },
      {
        "name": "info",
        "type": "function",
        "description": "current study configuration, including set variation, activeExperimentName",
        "async": true,
        "defaultReturn": {
          "variation": "styleA"
        }
      },
      {
        "name": "dataPermissions",
        "type": "function",
        "description": "object of current dataPermissions with keys shield, pioneer, telemetry, 'ok'",
        "async": true,
        "defaultReturn": {
          "shield": true,
          "pioneer": false
        }
      },
      {
        "name": "sendTelemetry",
        "type": "function",
        "async": true,
        "parameters": [
          {
            "name": "payload",
            "type": "object"
          },
          {
            "name": "type"
          }
        ],
        "defaultReturn": "undefined",
        "returns": "Nothing"
      },
      {
        "name": "getTelemetry",
        "type": "function",
        "async": true,
        "description": "for isEligible, testing, and other uses, get recent stored Telemetry pings",
        "defaultReturn": [
          {
            "pingType": "main"
          }
        ],
        "returns": "Array of Telemetry pings",
        "parameters": [
          {
            "name": "telemetrySelectionOptions",
            "description": "`{ type, n, minTimestamp, headersOnly }`"
          }
        ]
      },
      {
        "name": "deterministicVariation",
        "type": "function",
        "defaultReturn": "styleA",
        "returns": "Name of a variation from weightedVariations",
        "async": true,
        "parameters": [
          {
            "name": "weightedVariations",
            "type": "object"
          },
          {
            "name": "algorithm",
            "type": "string"
          },
          {
            "name": "fraction",
            "optional": true,
            "type": "Number"
          }
        ]
      },
      {
        "name": "surveyUrl",
        "type": "function",
        "async": true,
        "description": "Format url with study covariate queryArgs appended / mixed in.\n\nUse this for constructing midpoint surveys.\n",
        "defaultReturn": "https://example.com?version=59.0&branch=studyA",
        "parameters": [
          {
            "name": "baseUrl",
            "type": "string"
          }
        ]
      },
      {
        "name": "validateJSON",
        "type": "function",
        "async": true,
        "defaultReturn": {
          "valid": true,
          "errors": []
        },
        "description": "Using AJV, do jsonschema validation of an object.  Can be used to validate your arguments, packets at client.",
        "returns": "a validation object - { bool valid, array errors }",
        "parameters": [
          {
            "name": "someJson",
            "type": "object"
          },
          {
            "name": "jsonschema",
            "descripton": "a valid jsonschema object",
            "type": "object"
          }
        ]
      }
    ],
    "events": [
      {
        "name": "onDataPermissionsChange",
        "type": "function",
        "defaultReturn": {
          "shield": true,
          "pioneer": false
        },
        "description": "Fires whenever any 'dataPermission' changes, with the new dataPermission object.  Allows watching for shield or pioneer revocation.",
        "parameters": [
          {
            "name": "updatedPermissions",
            "type": "object"
          }
        ]
      }
    ]
  }
]
