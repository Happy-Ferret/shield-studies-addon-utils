[
  {
    "namespace": "study",
    "description":
      "Interface for shield studies, for use by `background.js` scripts.",
    "apiVersion": 5,
    "types": [
      {
        "id": "studySetup",
        "type": "object",
        "additionalProperties": {
          "type": "any"
        }
      },
      {
        "id": "weightedVariations",
        "type": "array"
      },
      {
        "id": "anEnding",
        "type": "object",
        "additionalProperties": {
          "type": "any"
        }
      }
    ],
    "functions": [
      {
        "name": "setup",
        "type": "function",
        "async": true,
        "description":
          "Attempt an setup/enrollment, with these effects\n- IFF firstRun\n  - send 'enter' ping\n  - if eligible, send 'install' ping\n  - else endStudy(\"ineligible\")\n- setActiveExperiment(studyConfig)\n\nNote:\n1. first run is tracked in a pref\n2. eligible is ONLY used during first run (install)\n\nall for side effects (setActiveExperiment)\n\nWill fire\n- study:ready\n- study:endStudy\n",
        "returns": "Nothing",
        "parameters": [
          {
            "name": "studyConfig",
            "type": "any"
          }
        ]
      },
      {
        "name": "endStudy",
        "type": "function",
        "async": true,
        "defaultReturn": "endingName",
        "description":
          "Optionally opens url, then ends study with pings ending, exit.  Study can only have one ending.  Uninstalls addon?",
        "parameters": [
          {
            "name": "anEndingName",
            "type": "string"
          },
          {
            "name": "anEndingObject",
            "type": "object",
            "optional": true
          }
        ],
        "returns": "directions for what to do next by the addon"
      },
      {
        "name": "info",
        "type": "function",
        "async": true,
        "description":
          "current study configuration, including set variation, activeExperimentName",
        "defaultReturn": {
          "variation": "styleA"
        },
        "parameters": []
      },
      {
        "name": "dataPermissions",
        "type": "function",
        "async": true,
        "description":
          "object of current dataPermissions with keys shield, pioneer, telemetry, 'ok'",
        "defaultReturn": {
          "shield": true,
          "pioneer": false
        },
        "parameters": []
      },
      {
        "name": "sendTelemetry",
        "type": "function",
        "async": true,
        "parameters": [
          {
            "name": "payload",
            "type": "object"
          },
          {
            "name": "pingType",
            "type": "string"
          }
        ],
        "defaultReturn": "undefined",
        "returns": "Nothing"
      },
      {
        "name": "getTelemetry",
        "type": "function",
        "async": true,
        "description":
          "for isEligible, testing, and other uses, get recent stored Telemetry pings",
        "defaultReturn": [
          {
            "pingType": "main"
          }
        ],
        "returns": "Array of Telemetry pings",
        "parameters": [
          {
            "name": "telemetrySelectionOptions",
            "type": "any",
            "description": "`{ type, n, minTimestamp, headersOnly }`"
          }
        ]
      },
      {
        "name": "deterministicVariation",
        "type": "function",
        "async": true,
        "defaultReturn": "styleA",
        "returns": "Name of a variation from weightedVariations",
        "parameters": [
          {
            "name": "weightedVariations",
            "type": "object"
          },
          {
            "name": "algorithm",
            "type": "string"
          },
          {
            "name": "fraction",
            "type": "Number",
            "optional": true
          }
        ]
      },
      {
        "name": "surveyUrl",
        "type": "function",
        "async": true,
        "description":
          "Format url with study covariate queryArgs appended / mixed in.\n\nUse this for constructing midpoint surveys.\n",
        "defaultReturn": "https://example.com?version=59.0&branch=studyA",
        "parameters": [
          {
            "name": "baseUrl",
            "type": "string"
          }
        ]
      },
      {
        "name": "validateJSON",
        "type": "function",
        "async": true,
        "defaultReturn": {
          "valid": true,
          "errors": []
        },
        "description":
          "Using AJV, do jsonschema validation of an object.  Can be used to validate your arguments, packets at client.",
        "returns": "a validation object - { bool valid, array errors }",
        "parameters": [
          {
            "name": "someJson",
            "type": "object"
          },
          {
            "name": "jsonschema",
            "type": "object",
            "descripton": "a valid jsonschema object"
          }
        ]
      }
    ],
    "events": [
      {
        "name": "onDataPermissionsChange",
        "type": "function",
        "defaultReturn": {
          "shield": true,
          "pioneer": false
        },
        "description":
          "Fires whenever any 'dataPermission' changes, with the new dataPermission object.  Allows watching for shield or pioneer revocation.",
        "parameters": [
          {
            "name": "updatedPermissions",
            "type": "object"
          }
        ]
      },
      {
        "name": "onReady",
        "type": "function",
        "defaultReturn": {
          "variation": "styleA",
          "install_timestamp": 1523968204184
        },
        "description":
          "Fires when the study is 'ready' for the feature to startup.",
        "parameters": [
          {
            "name": "studyInfo",
            "type": "object"
          }
        ]
      },
      {
        "name": "onEndStudy",
        "type": "function",
        "defaultReturn": {
          "urls": []
        },
        "description": "Listen for when the study wants to end",
        "parameters": [
          {
            "name": "endingSteps",
            "type": "object"
          }
        ]
      }
    ]
  }
]
